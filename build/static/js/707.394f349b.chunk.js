"use strict";(self.webpackChunkclient360=self.webpackChunkclient360||[]).push([[707],{1707:function(e,l,a){a.r(l),a.d(l,{default:function(){return Q}});var n=a(47313),i=a(9019),t=a(73428),s=a(93405),o=a(61113),r=a(41806),d=a(85281),c=a(24631),u=a(48310),m=a(67216),h=a(31095),x=a(6210),f=a(31387),v=a(35235),p=a(35192),j=a(43997),g=a(82406),Z=a(97890),y=a(25002),b=a(85582),w=a(47131),C=a(51405),N=a(93567),S=a(50494),k=a(87038),F=a(18210),L=a(23510),z=a(32270),A=a(66149),_=a(1550),I=a(5178),P=a(55685),B=a(74268),D=a(88797),E=a(4117),W=a(96467),T=a(33604),V=a(23195),$=a(83929),O=a(79429),q=a(3463),H=a(35460),J=a(78830),R=a(46417);var K=e=>{const{open:l,handleClose:a,fileId:t}=e,[s,r]=(0,n.useState)([]),[d,c]=(0,n.useState)([]);(0,n.useEffect)((()=>{(async()=>{try{const e=await(0,x.ac)("api/contact/viewallcontacts");r(e.data.contactDetails)}catch(e){console.log(e)}})(),(async()=>{try{const e=await(0,x.ac)("api/lead/viewallleads");c(e.data)}catch(e){console.log(e)}})()}),[]);const u=(0,O.TA)({initialValues:{category:"lead",assignment:"default"},validationSchema:q.Ry({category:q.Z_().required("Category is required")}),onSubmit:async(e,l)=>{let{resetForm:n}=l;(async(e,l)=>{try{"contact"===e.category?e.linkContact=e.assignment:e.linkLead=e.assignment,console.log(e),200===(await(0,x.Fv)(`api/document/link-document/${t}`,e)).status?(f.Am.success(`${e.category} Linked successfully`),a(),l()):f.Am.error(`cannot add ${e.category} `)}catch(n){console.log(n),f.Am.error(`cannot add ${e.category} `)}})(e,n)}});return(0,R.jsx)("div",{children:(0,R.jsxs)(A.Z,{open:l,onClose:a,"aria-labelledby":"scroll-dialog-title","aria-describedby":"scroll-dialog-description",children:[(0,R.jsxs)(T.Z,{id:"scroll-dialog-title",style:{display:"flex",justifyContent:"space-between"},children:[(0,R.jsx)(o.Z,{variant:"h6",children:"Link With Document"}),(0,R.jsx)(o.Z,{children:(0,R.jsx)(V.Z,{onClick:a,style:{cursor:"pointer"}})})]}),(0,R.jsx)(W.Z,{dividers:!0,sx:{width:"100%",minWidth:"600px"},children:(0,R.jsxs)("form",{children:[(0,R.jsx)(i.ZP,{item:!0,xs:12,sm:12,md:6,children:(0,R.jsxs)(_.Z,{fullWidth:!0,children:[(0,R.jsx)(I.Z,{sx:{marginTop:"2px"},children:"Link With"}),(0,R.jsxs)(P.Z,{row:!0,"aria-label":"category",name:"category",value:u.values.category,onChange:u.handleChange,children:[(0,R.jsx)($.Z,{value:"contact",control:(0,R.jsx)(B.Z,{}),label:"Contact"}),(0,R.jsx)($.Z,{value:"lead",control:(0,R.jsx)(B.Z,{}),label:"Lead"})]})]})}),(0,R.jsx)(i.ZP,{item:!0,xs:12,sm:12,md:12,sx:{marginTop:"3px"},children:(0,R.jsxs)(_.Z,{fullWidth:!0,children:[(0,R.jsx)(I.Z,{children:"contact"===u.values.category?"Link Contact":"Link Lead"}),(0,R.jsx)(D.Z,{id:"assignment",name:"assignment",label:"",size:"small",fullWidth:!0,value:u.values.assignment,onChange:u.handleChange,error:u.touched.assignment&&Boolean(u.errors.assignment),children:"contact"===u.values.category?[(0,R.jsx)(C.Z,{value:"default",disabled:!0,children:"Select Link with contacts"},"default"),...s.map((e=>(0,R.jsx)(C.Z,{value:e._id,children:e.firstName},e._id)))]:[(0,R.jsx)(C.Z,{value:"default",disabled:!0,children:"Select Link with Lead"},"default"),...d.map((e=>(0,R.jsx)(C.Z,{value:e._id,children:e.leadName},e._id)))]})]})})]})}),(0,R.jsx)(E.Z,{children:(0,R.jsxs)(h.Z,{onClick:u.handleSubmit,variant:"contained",style:{backgroundColor:H.Z.info,color:"#fff"},children:[(0,R.jsx)(v.Z,{fontSize:"small",sx:{mr:1}})," Link"]})})]})})};var M=e=>{var l;let{item:a,name:i,isFolder:t}=e;const[s,r]=(0,n.useState)(!1),[d,A]=(0,n.useState)(""),_=(0,Z.s0)(),[I,P]=(0,n.useState)(null),[B,D]=(0,n.useState)(null),[E,W]=(0,n.useState)(!1),[T,V]=(0,n.useState)(!1),[$,O]=(0,n.useState)(null),q=()=>{W(null),D(null)},H=Boolean(B),J=H?"simple-popover":void 0;return(0,R.jsxs)(u.Z,{sx:{width:"100%"},children:[(0,R.jsx)(K,{open:T,handleClose:async e=>{V(!1)},fileId:$}),(0,R.jsx)(m.ZP,{alignItems:"center",display:"flex",sx:{"&:hover":{cursor:"pointer",textDecoration:"none"}},children:(0,R.jsxs)(o.Z,{alignItems:"center",justifyContent:"space-between",display:"flex",width:"100%",onClick:t?()=>{r(!s)}:void 0,children:[(0,R.jsxs)(o.Z,{width:"70%",display:"flex",alignItems:"center",children:[(0,R.jsx)(N.Z,{sx:{mr:1}}),t&&(s?(0,R.jsx)(S.Z,{"aria-label":"Expand"}):(0,R.jsx)(k.Z,{"aria-label":"Collapse"})),a.folderName]}),(0,R.jsx)(o.Z,{sx:{width:"100%"},textAlign:"right",children:(0,R.jsxs)(b.Z,{children:[(0,R.jsx)(w.Z,{size:"small",color:"inherit",children:(0,R.jsx)(F.Z,{})}),(0,R.jsx)(b.Z,{anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},getContentAnchorEl:null,children:(0,R.jsx)(C.Z,{children:(0,R.jsx)(c.Z,{label:"New Folder",variant:"outlined",size:"small",value:d,onChange:e=>A(e.target.value),onKeyDown:e=>"Enter"===e.key&&void(a.some((e=>e.folderName===d))?console.log("Folder with the same name already exists"):console.log({folderName:d,files:[]}))})})})]})})]})}),s&&(0,R.jsx)(u.Z,{sx:{width:"100%"},children:null===a||void 0===a||null===(l=a.files)||void 0===l?void 0:l.map(((e,l)=>(0,R.jsxs)("div",{children:[(0,R.jsxs)(m.ZP,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,R.jsxs)(o.Z,{sx:{display:"flex",alignItems:"center"},children:[(0,R.jsx)(L.Z,{sx:{mr:1}}),e.fileName]}),(0,R.jsx)(h.Z,{onClick:e=>((e,l)=>{W(l===E?null:l),D(e.currentTarget)})(e,l),children:(0,R.jsx)(j.Z,{})})]}),(0,R.jsx)(y.ZP,{id:J,open:H&&E===l,anchorEl:B,onClose:q,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:(0,R.jsxs)("div",{style:{padding:"20px"},children:[(0,R.jsxs)(C.Z,{onClick:()=>(async e=>{if(e){console.log(e._id,"file id ");let l=await(0,x.ac)("api/document/download/",e._id);l&&200===l.status?(window.open(`${g.a.baseUrl}api/document/download/${e._id}`),f.Am.success("file Download successful")):l&&404===l.response.status&&f.Am.error("file Not Found")}})(e),children:[(0,R.jsx)(z.Z,{fontSize:"small",sx:{mr:1}}),"Download"]}),(0,R.jsxs)(C.Z,{onClick:()=>(async e=>{O(e._id),V(!0)})(e),children:[(0,R.jsx)(v.Z,{fontSize:"small",sx:{mr:1}}),"Link"]}),(0,R.jsxs)(C.Z,{onClick:()=>(async e=>{console.log(e._id,"file id ");let l=await(0,x.ef)("api/document/delete/",e._id);l&&200===l.status?(f.Am.success("file Deleted successful"),setTimeout((()=>{_(0)}),700)):l&&404===l.response.status&&f.Am.error("file Not Found")})(e),children:[(0,R.jsx)(p.Z,{fontSize:"small",sx:{mr:1}}),"Delete"]})]})})]},l)))})]})},U=a(41727),G=a(99132);var Q=()=>{const[e,l]=(0,n.useState)([]),[a,f]=(0,n.useState)(!0),[v,p]=(0,n.useState)(!1),j=JSON.parse(localStorage.getItem("user")),g=async()=>{p(!0);let e=await(0,x.ac)("admin"===j.role?"api/document":`api/document?createBy=${j._id}`);l(null===e||void 0===e?void 0:e.data),p(!1)},{handleBlur:Z,handleChange:y,handleSubmit:b,resetForm:w,setFieldValue:C,values:N,errors:S,touched:k}=(0,O.TA)({initialValues:{folderName:"",files:[],filename:""},validationSchema:J.Bl,onSubmit:e=>{(async e=>{try{p(!0);const l=new FormData;null===l||void 0===l||l.append("folderName",e.folderName),null===l||void 0===l||l.append("createBy",JSON.parse(localStorage.getItem("user"))._id),null===l||void 0===l||l.append("filename",e.filename),console.log(localStorage.getItem("user")._id,"formdata"),Array.from(e.files).forEach((e=>{null===l||void 0===l||l.append("files",e)}));let a=await(0,x.Fv)("api/document/add",l);console.log(a,"response"),a&&200===a.status&&(g(),w())}catch(l){console.log(l)}finally{p(!1)}})(e),w()}});return(0,n.useEffect)((()=>{g()}),[b]),(0,R.jsxs)(i.ZP,{container:!0,spacing:2,children:[(0,R.jsx)(i.ZP,{item:!0,xs:12,md:7,children:(0,R.jsx)(t.Z,{children:(0,R.jsxs)(s.Z,{children:[(0,R.jsx)(o.Z,{variant:"h5",gutterBottom:!0,children:"File Explorer"}),v?(0,R.jsx)(r.Z,{display:"flex",justifyContent:"center",alignItems:"center",height:200,children:(0,R.jsx)(d.Z,{})}):0===(null===e||void 0===e?void 0:e.length)?(0,R.jsx)(o.Z,{align:"center",variant:"subtitle1",fontWeight:"bold",children:"-- No Document Found --"}):null===e||void 0===e?void 0:e.map(((e,l)=>(0,R.jsx)(M,{name:e.folderName,isFolder:!0,item:e},l)))]})})}),(0,R.jsx)(i.ZP,{item:!0,xs:12,md:5,children:(0,R.jsx)(t.Z,{children:(0,R.jsx)(s.Z,{children:(0,R.jsxs)("form",{onSubmit:b,children:[(0,R.jsx)(c.Z,{onFocus:()=>f(!0),fullWidth:!0,label:"Folder Name",variant:"outlined",size:"small",margin:"normal",value:N.folderName,name:"folderName",placeholder:"Enter Folder Name",onChange:y,onBlur:Z,error:!(!S.folderName||!k.folderName),helperText:S.folderName&&k.folderName&&S.folderName}),a&&(null===N||void 0===N?void 0:N.folderName)&&(null===e||void 0===e?void 0:e.filter((e=>{var l,a;return null===e||void 0===e||null===(l=e.folderName)||void 0===l||null===(a=l.toLowerCase())||void 0===a?void 0:a.includes(null===N||void 0===N?void 0:N.folderName.toLowerCase())})).length)>0&&(0,R.jsx)(u.Z,{position:"relative",border:"1px solid",bg:"gray.100",width:"100%",borderRadius:"0px 0px 20px 20px",lineHeight:1,children:null===e||void 0===e?void 0:e.filter((e=>{var l,a;return null===e||void 0===e||null===(l=e.folderName)||void 0===l||null===(a=l.toLowerCase())||void 0===a?void 0:a.includes(null===N||void 0===N?void 0:N.folderName.toLowerCase())})).map(((e,l)=>(0,R.jsx)(m.ZP,{p:3,borderBottom:"2px solid #efefef",sx:{"&:last-child":{borderBottom:"none"}},cursor:"pointer",onClick:()=>{C("folderName",null===e||void 0===e?void 0:e.folderName)},children:null===e||void 0===e?void 0:e.folderName},l)))}),(0,R.jsx)(c.Z,{fullWidth:!0,label:"",variant:"outlined",size:"small",margin:"normal",name:"files",placeholder:"Select a file or folder",onChange:e=>C("files",e.currentTarget.files),type:"file",InputProps:{startAdornment:(0,R.jsx)(U.Z,{position:"start",children:(0,R.jsx)(G.Z,{})})},inputProps:{accept:".pdf, .doc, .docx",multiple:!0}}),(0,R.jsx)(c.Z,{fullWidth:!0,label:"File Name",variant:"outlined",size:"small",margin:"normal",value:N.filename,name:"filename",placeholder:"Enter File Name",onChange:y,onBlur:Z,error:!(!S.filename||!k.filename),helperText:S.filename&&k.filename&&S.filename}),(0,R.jsx)(h.Z,{type:"submit",disabled:v,variant:"contained",color:"primary",children:v?(0,R.jsx)(d.Z,{size:24}):"Publish now"})]})})})})]})}},99132:function(e,l,a){var n=a(64836);l.Z=void 0;var i=n(a(45045)),t=a(46417);l.Z=(0,i.default)((0,t.jsx)("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5c0-1.38 1.12-2.5 2.5-2.5s2.5 1.12 2.5 2.5v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5c0 1.38 1.12 2.5 2.5 2.5s2.5-1.12 2.5-2.5V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6z"}),"AttachFile")}}]);